<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - UUS</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --sidebar-width: 280px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: var(--sidebar-width);
            background: linear-gradient(135deg, var(--primary-color) 0%, #34495e 100%);
            color: white;
            overflow-y: auto;
            transition: all 0.3s ease;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header .logo {
            max-width: 100%;
            height: auto;
            transition: all 0.3s ease;
        }

        .sidebar.collapsed .sidebar-header .logo {
            width: 40px;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            margin: 5px 15px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-link:hover,
        .nav-link.active {
            background-color: rgba(255,255,255,0.1);
            color: white;
            transform: translateX(5px);
        }

        .nav-link i {
            width: 20px;
            margin-right: 15px;
            text-align: center;
        }

        .sidebar.collapsed .nav-link span {
            display: none;
        }

        .sidebar-footer {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            padding: 0 15px;
        }

        .main-content {
            margin-left: var(--sidebar-width);
            min-height: 100vh;
            transition: margin-left 0.3s ease;
            padding: 0;
        }

        .main-content.expanded {
            margin-left: 70px;
        }

        .top-navbar {
            background: white;
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 999;
        }

        .content-area {
            padding: 30px;
        }

        .section-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, var(--secondary-color), #2980b9);
            color: white;
            padding: 20px 30px;
            border-bottom: none;
        }

        .section-body {
            padding: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border-left: 4px solid var(--secondary-color);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }

        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
        }

        .table {
            margin: 0;
        }

        .table th {
            background-color: var(--primary-color);
            color: white;
            border: none;
            font-weight: 600;
        }

        .btn-custom {
            border-radius: 8px;
            padding: 8px 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .form-control,
        .form-select {
            border-radius: 8px;
            border: 2px solid #e9ecef;
            padding: 12px 15px;
            transition: all 0.3s ease;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }

        .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--secondary-color), #2980b9);
            color: white;
            border-radius: 15px 15px 0 0;
        }

        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .application-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 4px solid var(--secondary-color);
        }

        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-pending { background-color: #fff3cd; color: #856404; }
        .status-accepted { background-color: #d1e7dd; color: #0f5132; }
        .status-rejected { background-color: #f8d7da; color: #721c24; }

        .toggle-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 1.2rem;
            cursor: pointer;
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box .form-control {
            padding-left: 45px;
        }

        .search-box .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Alert Messages -->
    <% if (alert) { %>
        <div class="alert alert-<%= alert.type === 'success' ? 'success' : 'danger' %> alert-dismissible fade show position-fixed" 
             style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;" id="alert">
            <i class="fas fa-<%= alert.type === 'success' ? 'check-circle' : 'exclamation-triangle' %> me-2"></i>
            <%= alert.message %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    <% } %>
    
    <% if (successAlert && successAlert.length > 0) { %>
        <div class="alert alert-success alert-dismissible fade show position-fixed" 
             style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;" id="success-alert">
            <i class="fas fa-check-circle me-2"></i>
            <%= successAlert %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    <% } %>
    
    <% if (dangerAlert && dangerAlert.length > 0) { %>
        <div class="alert alert-danger alert-dismissible fade show position-fixed" 
             style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;" id="danger-alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <%= dangerAlert %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    <% } %>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="/static/image/logo2.0black.png" alt="UUS Logo" class="logo" style="filter: brightness(0) invert(1);">
        </div>
        
        <nav class="nav-menu">
            <div class="nav-item">
                <a href="#" class="nav-link active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="user-management">
                    <i class="fas fa-users"></i>
                    <span>User Management</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="login-management">
                    <i class="fas fa-key"></i>
                    <span>Login Management</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="statistics">
                    <i class="fas fa-chart-bar"></i>
                    <span>Statistics</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="partners">
                    <i class="fas fa-university"></i>
                    <span>Partner Universities</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="events">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Events & Tasks</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="departments">
                    <i class="fas fa-building"></i>
                    <span>Departments</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="study-levels">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Study Levels</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="courses">
                    <i class="fas fa-book"></i>
                    <span>Courses</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="news">
                    <i class="fas fa-newspaper"></i>
                    <span>News</span>
                </a>
            </div>
        </nav>
        
        <div class="sidebar-footer">
            <div class="nav-item">
                <a href="#" class="nav-link">
                    <i class="fas fa-question-circle"></i>
                    <span>Need Help?</span>
                </a>
            </div>
            <div class="nav-item">
                <form action="/auth/logout-admin" method="POST" class="d-inline">
                    <button type="submit" class="nav-link border-0 bg-transparent text-start w-100">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Navbar -->
        <div class="top-navbar">
            <div class="d-flex align-items-center">
                <button class="toggle-btn me-3" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h4 class="mb-0 text-primary fw-bold">Admin Dashboard</h4>
            </div>
            <div class="d-flex align-items-center">
                <% if (userRole === 'admin') { %>
                    <a href="/admin/change-requests" class="btn btn-outline-primary btn-custom me-3">
                        <i class="fas fa-cog me-2"></i>Change Requests
                    </a>
                <% } %>
                <div class="dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user-circle me-2"></i>Admin
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Profile</a></li>
                        <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Settings</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <form action="/auth/logout-admin" method="POST" class="d-inline">
                                <button type="submit" class="dropdown-item">
                                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                                </button>
                            </form>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">

            <!-- Dashboard Section -->
            <div class="page-section active" id="dashboard">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon bg-primary text-white">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                        <h3 class="fw-bold text-primary"><%= studentCount %></h3>
                        <p class="text-muted mb-0">Total Students</p>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon bg-success text-white">
                            <i class="fas fa-chalkboard-teacher"></i>
                        </div>
                        <h3 class="fw-bold text-success"><%= professorCount %></h3>
                        <p class="text-muted mb-0">Total Professors</p>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon bg-warning text-white">
                            <i class="fas fa-building"></i>
                        </div>
                        <h3 class="fw-bold text-warning"><%= departmentCount %></h3>
                        <p class="text-muted mb-0">Departments</p>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon bg-info text-white">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <h3 class="fw-bold text-info"><%= data.length %></h3>
                        <p class="text-muted mb-0">Applications</p>
                    </div>
                </div>

                <!-- Applications Section -->
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>New Applications</h3>
                    </div>
                    <div class="section-body">
                        <% if (data.length > 0) { %>
                            <div class="row">
                                <% data.forEach(row => { %>
                                    <div class="col-lg-6 col-xl-4 mb-4">
                                        <div class="application-card">
                                            <div class="d-flex justify-content-between align-items-start mb-3">
                                                <h5 class="fw-bold text-primary mb-0">
                                                    <%= row.name %> <%= row.lastname %>
                                                </h5>
                                                <span class="status-badge status-<%= row.status %>">
                                                    <%= row.status.charAt(0).toUpperCase() + row.status.slice(1) %>
                                                </span>
                                            </div>
                                            <div class="mb-3">
                                                <p class="mb-1"><i class="fas fa-envelope text-muted me-2"></i><%= row.email %></p>
                                                <p class="mb-1"><i class="fas fa-phone text-muted me-2"></i><%= row.phone_number %></p>
                                                <p class="mb-1"><i class="fas fa-school text-muted me-2"></i><%= row.high_school %></p>
                                                <p class="mb-1"><i class="fas fa-graduation-cap text-muted me-2"></i><%= row.study_level %></p>
                                                <p class="mb-0"><i class="fas fa-building text-muted me-2"></i><%= row.choose_dep %></p>
                                            </div>
                                            <select class="form-select status-select" data-id="<%= row.user_id %>">
                                                <option value="pending" <%= row.status == 'pending' ? 'selected' : '' %>>Pending</option>
                                                <option value="accepted" <%= row.status == 'accepted' ? 'selected' : '' %>>Accepted</option>
                                                <option value="rejected" <%= row.status == 'rejected' ? 'selected' : '' %>>Rejected</option>
                                            </select>
                                        </div>
                                    </div>
                                <% }); %>
                            </div>
                        <% } else { %>
                            <div class="text-center py-5">
                                <i class="fas fa-inbox text-muted" style="font-size: 4rem;"></i>
                                <h4 class="text-muted mt-3">No New Applications</h4>
                                <p class="text-muted">All applications have been processed.</p>
                            </div>
                        <% } %>
                    </div>
                </div>

                <!-- Erasmus Applications Section -->
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="mb-0"><i class="fas fa-globe-europe me-2"></i>Erasmus Applications</h3>
                    </div>
                    <div class="section-body">
                        <% if (card.length > 0) { %>
                            <div class="row">
                                <% card.forEach(apply => { %>
                                    <div class="col-lg-6 col-xl-4 mb-4">
                                        <div class="application-card">
                                            <div class="d-flex justify-content-between align-items-start mb-3">
                                                <h5 class="fw-bold text-success mb-0"><%= apply.fullname %></h5>
                                                <form action="/admin/delete-erasmus-application/<%= apply.application_id %>" method="POST" class="d-inline">
                                                    <input type="hidden" name="_method" value="DELETE">
                                                    <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure?')">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                            <div class="mb-3">
                                                <p class="mb-1"><i class="fas fa-map-marker-alt text-muted me-2"></i><%= apply.place %></p>
                                                <p class="mb-1"><i class="fas fa-calendar text-muted me-2"></i><%= apply.semester %></p>
                                                <p class="mb-1"><i class="fas fa-building text-muted me-2"></i><%= apply.Department.dep_name %></p>
                                                <p class="mb-0"><i class="fas fa-envelope text-muted me-2"></i><%= apply.User.email %></p>
                                            </div>
                                        </div>
                                    </div>
                                <% }); %>
                            </div>
                        <% } else { %>
                            <div class="text-center py-5">
                                <i class="fas fa-globe-europe text-muted" style="font-size: 4rem;"></i>
                                <h4 class="text-muted mt-3">No Erasmus Applications</h4>
                                <p class="text-muted">No new Erasmus applications to review.</p>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>

            <!-- User Management Section -->
            <div class="page-section" id="user-management">
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="mb-0"><i class="fas fa-users me-2"></i>Register New User</h3>
                    </div>
                    <div class="section-body">
                        <div class="row">
                            <div class="col-lg-8">
                                <form action="/admin/register" method="POST" enctype="multipart/form-data">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="firstName" class="form-label">First Name</label>
                                            <input type="text" id="firstName" name="name" class="form-control" placeholder="Enter first name" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="lastName" class="form-label">Last Name</label>
                                            <input type="text" id="lastName" name="lastname" class="form-control" placeholder="Enter last name" required>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="address" class="form-label">Address</label>
                                        <input type="text" id="address" name="address" class="form-control" placeholder="Enter address" required>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="email" class="form-label">Email</label>
                                            <input type="email" id="email" name="email" class="form-control" placeholder="Enter email" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="phoneNumber" class="form-label">Phone Number</label>
                                            <input type="text" id="phoneNumber" name="phone_number" class="form-control" placeholder="Enter phone number" required>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="role" class="form-label">Role</label>
                                            <select id="role" name="role" class="form-select" required>
                                                <option value="" disabled selected>Select role</option>
                                                <% availableRoles.forEach(role => { %>
                                                    <option value="<%= role %>">
                                                        <%= role.charAt(0).toUpperCase() + role.slice(1) %>
                                                    </option>
                                                <% }); %>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="department" class="form-label">Department</label>
                                            <select id="department" name="dep_id" class="form-select" required>
                                                <option value="" disabled selected>Select department</option>
                                                <% department.forEach(dep => { %>
                                                    <option value="<%= dep.dep_id %>"><%= dep.dep_name %></option>
                                                <% }); %>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mb-4">
                                        <label for="profileFiles" class="form-label">Profile Pictures</label>
                                        <input type="file" id="profileFiles" name="files" multiple class="form-control" onchange="loadFile(event)">
                                    </div>
                                    <div class="d-flex gap-2">
                                        <button type="submit" class="btn btn-primary btn-custom">
                                            <i class="fas fa-user-plus me-2"></i>Create User
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-custom" data-bs-toggle="modal" data-bs-target="#userSearchModal">
                                            <i class="fas fa-search me-2"></i>Search Users
                                        </button>
                                    </div>
                                </form>
                            </div>
                            <div class="col-lg-4">
                                <div class="text-center">
                                    <h5 class="mb-3">Profile Preview</h5>
                                    <div id="output" class="border rounded p-3" style="min-height: 200px;">
                                        <img src="/static/image/default.png" alt="Profile Preview" class="img-fluid rounded" style="max-height: 150px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Login Management Section -->
            <div class="page-section" id="login-management">
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="mb-0"><i class="fas fa-key me-2"></i>Login Access Management</h3>
                    </div>
                    <div class="section-body">
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="form-control" id="loginSearchInput" placeholder="Search users by name..." autocomplete="off">
                        </div>
                        <div id="loginRecommendations" class="mt-3"></div>
                        
                        <div class="alert alert-info mt-4">
                            <h5 class="alert-heading"><i class="fas fa-info-circle me-2"></i>Information</h5>
                            <p class="mb-0">This function is used for giving users (admin, student, professor) access to login into this website. Search by name and the admin will be redirected to another page for further edits/creation.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Section -->
            <div class="page-section" id="statistics">
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Feedback Statistics</h3>
                    </div>
                    <div class="section-body">
                        <!-- Feedback Cards -->
                        <div class="row mb-4">
                            <% if (row.length > 0) { %>
                                <% row.slice(0, 6).forEach(feedback => { %>
                                    <div class="col-lg-4 col-md-6 mb-3">
                                        <div class="card h-100">
                                            <div class="card-body">
                                                <h6 class="card-title text-primary">
                                                    <i class="fas fa-user me-2"></i><%= feedback.name %> <%= feedback.lastname %>
                                                </h6>
                                                <p class="card-text"><%= feedback.text_box %></p>
                                                <small class="text-muted">Rating: <%= feedback.rating %>/3</small>
                                            </div>
                                        </div>
                                    </div>
                                <% }); %>
                            <% } %>
                        </div>

                        <!-- Statistics Cards -->
                        <div class="row">
                            <div class="col-lg-3 col-md-6 mb-4">
                                <div class="stat-card">
                                    <div class="stat-icon bg-primary text-white">
                                        <i class="fas fa-star"></i>
                                    </div>
                                    <h3 class="fw-bold text-primary"><%= averageRating.toFixed(1) %></h3>
                                    <p class="text-muted mb-0">Average Experience (1-3)</p>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 mb-4">
                                <div class="stat-card">
                                    <div class="stat-icon bg-success text-white">
                                        <i class="fas fa-thumbs-up"></i>
                                    </div>
                                    <h3 class="fw-bold text-success"><%= averageSatisfiedRating.toFixed(1) %></h3>
                                    <p class="text-muted mb-0">Satisfaction (1-10)</p>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 mb-4">
                                <div class="stat-card">
                                    <div class="stat-icon bg-info text-white">
                                        <i class="fas fa-comments"></i>
                                    </div>
                                    <h3 class="fw-bold text-info"><%= row.length %></h3>
                                    <p class="text-muted mb-0">Total Feedback</p>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 mb-4">
                                <div class="stat-card">
                                    <div class="stat-icon bg-warning text-white">
                                        <i class="fas fa-chart-pie"></i>
                                    </div>
                                    <h3 class="fw-bold text-warning">
                                        <%= Object.keys(recommend).filter(key => key === 'yes').length > 0 ? 
                                            Math.round((recommend['yes'] || 0) / row.length * 100) : 0 %>%
                                    </h3>
                                    <p class="text-muted mb-0">Recommendation Rate</p>
                                </div>
                            </div>
                        </div>

                        <!-- Detailed Statistics -->
                        <div class="row">
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>More Information Requests</h5>
                                    </div>
                                    <div class="card-body">
                                        <% Object.keys(moreInfoCounts).forEach(info => { %>
                                            <div class="d-flex justify-content-between mb-2">
                                                <span class="text-capitalize"><%= info %>:</span>
                                                <span class="badge bg-primary"><%= moreInfoCounts[info] %></span>
                                            </div>
                                        <% }); %>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Difficulties Reported</h5>
                                    </div>
                                    <div class="card-body">
                                        <% Object.keys(difficulties).forEach(info => { %>
                                            <div class="d-flex justify-content-between mb-2">
                                                <span class="text-capitalize"><%= info %>:</span>
                                                <span class="badge bg-warning"><%= difficulties[info] %></span>
                                            </div>
                                        <% }); %>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0"><i class="fas fa-heart me-2"></i>Recommendations</h5>
                                    </div>
                                    <div class="card-body">
                                        <% Object.keys(recommend).forEach(info => { %>
                                            <div class="d-flex justify-content-between mb-2">
                                                <span class="text-capitalize"><%= info %>:</span>
                                                <span class="badge bg-<%= info === 'yes' ? 'success' : 'secondary' %>"><%= recommend[info] %></span>
                                            </div>
                                        <% }); %>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0"><i class="fas fa-building me-2"></i>Department Distribution</h5>
                                    </div>
                                    <div class="card-body">
                                        <% departmentStudentCounts.forEach(dept => { %>
                                            <div class="d-flex justify-content-between mb-2">
                                                <span><%= dept.dep_name %>:</span>
                                                <span class="badge bg-info"><%= dept.count %> students</span>
                                            </div>
                                        <% }); %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Partners Section -->
            <div class="page-section" id="partners">
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="mb-0"><i class="fas fa-university me-2"></i>Partner Universities Management</h3>
                    </div>
                    <div class="section-body">
                        <div class="row mb-4">
                            <div class="col-lg-6">
                                <div class="search-box">
                                    <i class="fas fa-search search-icon"></i>
                                    <input type="text" class="form-control" id="partnerSearchInput" placeholder="Search partners..." autocomplete="off">
                                </div>
                                <div id="partnerRecommendations" class="mt-3"></div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="fas fa-plus me-2"></i>Add New Partner University</h5>
                                    </div>
                                    <div class="card-body">
                                        <form action="/admin/create-partner" method="POST" enctype="multipart/form-data">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="partnerName" class="form-label">University Name</label>
                                                    <input type="text" id="partnerName" name="name" class="form-control" placeholder="Enter university name" required>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="partnerCountry" class="form-label">Country</label>
                                                    <input type="text" id="partnerCountry" name="countries" class="form-control" placeholder="Enter country" required>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="openScholars" class="form-label">Available Scholarships</label>
                                                    <input type="number" id="openScholars" name="open_scolars" class="form-control" placeholder="Number of scholarships" required>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="partnerLevel" class="form-label">Study Level</label>
                                                    <select id="partnerLevel" name="level" class="form-select">
                                                        <option value="" disabled selected>Select level</option>
                                                        <option value="Bachelor">Bachelor</option>
                                                        <option value="Master">Master</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="partnerSemester" class="form-label">Semester</label>
                                                    <select id="partnerSemester" name="semester" class="form-select">
                                                        <option value="" disabled selected>Select semester</option>
                                                        <option value="Winter">Winter</option>
                                                        <option value="Summer">Summer</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="partnerDepartment" class="form-label">Department</label>
                                                    <select id="partnerDepartment" name="dep_id" class="form-select">
                                                        <option value="" disabled selected>Select department</option>
                                                        <% department.forEach(dep => { %>
                                                            <option value="<%= dep.dep_id %>"><%= dep.dep_name %></option>
                                                        <% }); %>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="partnerPhotos" class="form-label">University Photos</label>
                                                <input type="file" id="partnerPhotos" name="photos" multiple class="form-control" onchange="loadFile2(event)">
                                            </div>
                                            <button type="submit" class="btn btn-primary btn-custom">
                                                <i class="fas fa-plus me-2"></i>Create Partner
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Photo Preview</h5>
                                    </div>
                                    <div class="card-body text-center">
                                        <div id="output2" style="min-height: 200px;">
                                            <img src="/static/image/default.png" alt="University Preview" class="img-fluid rounded" style="max-height: 150px;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Events & Tasks Section -->
            <div class="page-section" id="events">
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Events & Tasks Management</h3>
                    </div>
                    <div class="section-body">
                        <div class="row">
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="fas fa-plus me-2"></i>Add New Event/Task</h5>
                                    </div>
                                    <div class="card-body">
                                        <form action="/task/create" method="POST">
                                            <div class="mb-3">
                                                <label for="taskName" class="form-label">Event/Task Name</label>
                                                <input type="text" id="taskName" name="taskName" class="form-control" placeholder="Enter event or task name" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="scheduledTime" class="form-label">Scheduled Date & Time</label>
                                                <input type="datetime-local" id="scheduledTime" name="scheduledTime" class="form-control" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="duration" class="form-label">Duration (days)</label>
                                                <input type="number" id="duration" name="duration" class="form-control" value="0" min="0" required>
                                            </div>
                                            <button type="submit" class="btn btn-primary btn-custom">
                                                <i class="fas fa-plus me-2"></i>Add Event/Task
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="fas fa-list me-2"></i>Existing Tasks</h5>
                                <span class="badge bg-primary"><%= tasks.length %> tasks</span>
                            </div>
                            <div class="card-body">
                                <% if (tasks.length > 0) { %>
                                    <div class="row">
                                        <% tasks.forEach(task => { %>
                                            <div class="col-lg-6 mb-3">
                                                <div class="card border-left-primary">
                                                    <div class="card-body">
                                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                                            <h6 class="fw-bold text-primary mb-0"><%= task.task_name %></h6>
                                                            <div class="dropdown">
                                                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                                                    <i class="fas fa-cog"></i>
                                                                </button>
                                                                <ul class="dropdown-menu">
                                                                    <li>
                                                                        <button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#editTaskModal<%= task.id %>">
                                                                            <i class="fas fa-edit me-2"></i>Edit
                                                                        </button>
                                                                    </li>
                                                                    <li>
                                                                        <form action="/task/delete/<%= task.id %>" method="POST" class="d-inline">
                                                                            <button type="submit" class="dropdown-item text-danger" onclick="return confirm('Are you sure?')">
                                                                                <i class="fas fa-trash me-2"></i>Delete
                                                                            </button>
                                                                        </form>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                        <p class="text-muted mb-1">
                                                            <i class="fas fa-calendar me-2"></i>
                                                            <%= new Date(task.scheduled_time).toLocaleDateString() %> 
                                                            <%= new Date(task.scheduled_time).toLocaleTimeString() %>
                                                        </p>
                                                        <p class="text-muted mb-0">
                                                            <i class="fas fa-clock me-2"></i>
                                                            Duration: <%= Math.floor((new Date(task.end_time) - new Date(task.scheduled_time)) / (1000 * 60 * 60 * 24)) %> days
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Edit Task Modal -->
                                            <div class="modal fade" id="editTaskModal<%= task.id %>" tabindex="-1">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title">Edit Task</h5>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                        </div>
                                                        <form action="/api/tasks/<%= task.id %>/update" method="POST">
                                                            <div class="modal-body">
                                                                <div class="mb-3">
                                                                    <label for="editTaskName<%= task.id %>" class="form-label">Task Name</label>
                                                                    <input type="text" id="editTaskName<%= task.id %>" name="taskName" class="form-control" value="<%= task.task_name %>" required>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label for="editScheduledTime<%= task.id %>" class="form-label">Scheduled Time</label>
                                                                    <input type="datetime-local" id="editScheduledTime<%= task.id %>" name="scheduledTime" class="form-control" 
                                                                           value="<%= new Date(task.scheduled_time).toISOString().slice(0, 16) %>" required>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label for="editDuration<%= task.id %>" class="form-label">Duration (days)</label>
                                                                    <input type="number" id="editDuration<%= task.id %>" name="duration" class="form-control" 
                                                                           value="<%= Math.floor((new Date(task.end_time) - new Date(task.scheduled_time)) / (1000 * 60 * 60 * 24)) %>" required>
                                                                </div>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                                <button type="submit" class="btn btn-primary">Update Task</button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        <% }); %>
                                    </div>
                                <% } else { %>
                                    <div class="text-center py-4">
                                        <i class="fas fa-calendar-times text-muted" style="font-size: 3rem;"></i>
                                        <h5 class="text-muted mt-3">No Tasks Found</h5>
                                        <p class="text-muted">Create your first event or task using the form above.</p>
                                    </div>
                                <% } %>
                            </div>
                        </div>

                        <!-- Calendar Include -->
                        <div class="mt-4">
                            <%- include('partials/Calendar'); %>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Departments Section -->
            <div class="page-section" id="departments">
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="mb-0"><i class="fas fa-building me-2"></i>Departments Management</h3>
                    </div>
                    <div class="section-body">
                        <div class="row mb-4">
                            <div class="col-lg-6">
                                <div class="alert alert-info">
                                    <h6 class="alert-heading"><i class="fas fa-info-circle me-2"></i>Information</h6>
                                    <p class="mb-1">Departments are used to categorize students and professors. You can create, edit and delete departments here.</p>
                                    <p class="mb-0">Total number of departments: <strong><%= departmentCount %></strong></p>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0"><i class="fas fa-plus me-2"></i>Create New Department</h6>
                                    </div>
                                    <div class="card-body">
                                        <form action="/admin/create-department" method="POST">
                                            <div class="input-group">
                                                <input type="text" name="dep_name" class="form-control" placeholder="Department Name" required>
                                                <button type="submit" class="btn btn-primary">
                                                    <i class="fas fa-plus"></i> Create
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <% if (department.length > 0) { %>
                                <% department.forEach(dep => { %>
                                    <div class="col-lg-4 col-md-6 mb-4">
                                        <div class="card h-100">
                                            <div class="card-body text-center">
                                                <div class="mb-3">
                                                    <i class="fas fa-building text-primary" style="font-size: 2.5rem;"></i>
                                                </div>
                                                <h5 class="card-title text-primary"><%= dep.dep_name %></h5>
                                                <p class="text-muted mb-3">
                                                    <%= departmentStudentCounts.find(d => d.dep_name === dep.dep_name)?.count || 0 %> Students
                                                </p>
                                                <div class="d-flex gap-2 justify-content-center">
                                                    <button class="btn btn-sm btn-outline-primary edit-department-btn" 
                                                            data-id="<%= dep.dep_id %>" data-name="<%= dep.dep_name %>"
                                                            data-bs-toggle="modal" data-bs-target="#editDepartmentModal">
                                                        <i class="fas fa-edit"></i> Edit
                                                    </button>
                                                    <form action="/admin/delete-department/<%= dep.dep_id %>" method="POST" class="d-inline">
                                                        <input type="hidden" name="_method" value="DELETE">
                                                        <button type="submit" class="btn btn-sm btn-outline-danger" 
                                                                onclick="return confirm('Are you sure you want to delete this department?')">
                                                            <i class="fas fa-trash"></i> Delete
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                <% }); %>
                            <% } else { %>
                                <div class="col-12">
                                    <div class="text-center py-5">
                                        <i class="fas fa-building text-muted" style="font-size: 4rem;"></i>
                                        <h4 class="text-muted mt-3">No Departments Found</h4>
                                        <p class="text-muted">Create your first department using the form above.</p>
                                    </div>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Edit Department Modal -->
            <div class="modal fade" id="editDepartmentModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title"><i class="fas fa-edit me-2"></i>Edit Department</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <form id="editDepartmentForm" method="POST">
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label for="editDepName" class="form-label">Department Name</label>
                                    <input type="text" id="editDepName" name="dep_name" class="form-control" required>
                                    <input type="hidden" id="editDepId" name="dep_id">
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-primary">Update Department</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Study Levels Section -->
            <div class="page-section" id="study-levels">
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="mb-0"><i class="fas fa-graduation-cap me-2"></i>Study Levels Management</h3>
                    </div>
                    <div class="section-body">
                        <div class="row mb-4">
                            <div class="col-lg-6">
                                <div class="alert alert-info">
                                    <h6 class="alert-heading"><i class="fas fa-info-circle me-2"></i>Information</h6>
                                    <p class="mb-0">Total Study Levels: <strong><%= totalStudyLevels %></strong></p>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0"><i class="fas fa-plus me-2"></i>Create New Study Level</h6>
                                    </div>
                                    <div class="card-body">
                                        <form action="/admin/create-study-level" method="POST">
                                            <div class="input-group">
                                                <input type="text" name="study_level" class="form-control" placeholder="Study Level Name" required>
                                                <button type="submit" class="btn btn-primary">
                                                    <i class="fas fa-plus"></i> Create
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <% if (StudyLevels.length > 0) { %>
                                <% StudyLevels.forEach(level => { %>
                                    <div class="col-lg-4 col-md-6 mb-4">
                                        <div class="card h-100">
                                            <div class="card-body text-center">
                                                <div class="mb-3">
                                                    <i class="fas fa-graduation-cap text-success" style="font-size: 2.5rem;"></i>
                                                </div>
                                                <h5 class="card-title text-success"><%= level.study_level %></h5>
                                                <div class="d-flex gap-2 justify-content-center">
                                                    <button class="btn btn-sm btn-outline-success edit-study-btn" 
                                                            data-id="<%= level.study_level_id %>" data-name="<%= level.study_level %>"
                                                            data-bs-toggle="modal" data-bs-target="#editStudyLevelModal">
                                                        <i class="fas fa-edit"></i> Edit
                                                    </button>
                                                    <form action="/admin/delete-study-level/<%= level.study_level_id %>" method="POST" class="d-inline">
                                                        <input type="hidden" name="_method" value="DELETE">
                                                        <button type="submit" class="btn btn-sm btn-outline-danger" 
                                                                onclick="return confirm('Are you sure you want to delete this study level?')">
                                                            <i class="fas fa-trash"></i> Delete
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                <% }); %>
                            <% } else { %>
                                <div class="col-12">
                                    <div class="text-center py-5">
                                        <i class="fas fa-graduation-cap text-muted" style="font-size: 4rem;"></i>
                                        <h4 class="text-muted mt-3">No Study Levels Found</h4>
                                        <p class="text-muted">Create your first study level using the form above.</p>
                                    </div>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Edit Study Level Modal -->
            <div class="modal fade" id="editStudyLevelModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title"><i class="fas fa-edit me-2"></i>Edit Study Level</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <form id="editStudyLevelForm" method="POST">
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label for="editStudyLevelName" class="form-label">Study Level Name</label>
                                    <input type="text" id="editStudyLevelName" name="study_level" class="form-control" required>
                                    <input type="hidden" id="editStudyLevelId" name="study_level_id">
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-success">Update Study Level</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Courses Section -->
            <div class="page-section" id="courses">
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="mb-0"><i class="fas fa-book me-2"></i>Courses Management</h3>
                    </div>
                    <div class="section-body">
                        <div class="row mb-4">
                            <div class="col-lg-6">
                                <div class="search-box">
                                    <i class="fas fa-search search-icon"></i>
                                    <input type="text" class="form-control" id="coursesSearchInput" placeholder="Search courses..." autocomplete="off">
                                </div>
                                <div id="coursesRecommendations" class="mt-3"></div>
                            </div>
                            <div class="col-lg-6">
                                <div class="d-flex justify-content-end align-items-center">
                                    <a href="/admin/viewAll/courses" class="btn btn-primary btn-custom">
                                        <i class="fas fa-eye me-2"></i>View All Courses
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <h6 class="alert-heading"><i class="fas fa-info-circle me-2"></i>Course Information</h6>
                            <p class="mb-0">Total Courses: <strong><%= courses.length %></strong></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- News Section -->
            <div class="page-section" id="news">
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="mb-0"><i class="fas fa-newspaper me-2"></i>News Management</h3>
                    </div>
                    <div class="section-body">
                        <!-- News Tags Management -->
                        <div class="row mb-4">
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0"><i class="fas fa-tags me-2"></i>News Tags</h6>
                                        <span class="badge bg-primary"><%= NewsTags.length %> tags</span>
                                    </div>
                                    <div class="card-body">
                                        <form action="/admin/create-news-tag" method="POST" class="mb-3">
                                            <div class="input-group">
                                                <input type="text" name="tag" class="form-control" placeholder="Tag name" required>
                                                <button type="submit" class="btn btn-primary">
                                                    <i class="fas fa-plus"></i> Add
                                                </button>
                                            </div>
                                        </form>
                                        <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#newsTagModal">
                                            <i class="fas fa-eye me-2"></i>View All Tags
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0"><i class="fas fa-list me-2"></i>News Categories</h6>
                                        <span class="badge bg-success"><%= NewsCategorys.length %> categories</span>
                                    </div>
                                    <div class="card-body">
                                        <form action="/admin/create-news-category" method="POST" class="mb-3">
                                            <div class="input-group">
                                                <input type="text" name="category" class="form-control" placeholder="Category name" required>
                                                <button type="submit" class="btn btn-success">
                                                    <i class="fas fa-plus"></i> Add
                                                </button>
                                            </div>
                                        </form>
                                        <button class="btn btn-outline-success btn-sm" data-bs-toggle="modal" data-bs-target="#newsCategoryModal">
                                            <i class="fas fa-eye me-2"></i>View All Categories
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Create News Article -->
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-plus me-2"></i>Create News Article</h5>
                            </div>
                            <div class="card-body">
                                <form action="/admin/create-news" method="POST" enctype="multipart/form-data">
                                    <div class="row">
                                        <div class="col-lg-8">
                                            <div class="mb-3">
                                                <label for="newsTitle" class="form-label">Article Title</label>
                                                <input type="text" id="newsTitle" name="title" class="form-control" placeholder="Enter article title" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="newsContent" class="form-label">Content</label>
                                                <textarea id="newsContent" name="content" class="form-control" rows="6" placeholder="Write your article content here..." required></textarea>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="newsCategory" class="form-label">Category</label>
                                                    <select id="newsCategory" name="category_id" class="form-select" required>
                                                        <option value="" disabled selected>Select category</option>
                                                        <% NewsCategorys.forEach(category => { %>
                                                            <option value="<%= category.category_id %>"><%= category.category_name %></option>
                                                        <% }); %>
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="newsTag" class="form-label">Tag</label>
                                                    <select id="newsTag" name="tag_id" class="form-select" required>
                                                        <option value="" disabled selected>Select tag</option>
                                                        <% NewsTags.forEach(tag => { %>
                                                            <option value="<%= tag.tag_id %>"><%= tag.tag %></option>
                                                        <% }); %>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="mb-3">
                                                <label for="newsPrimaryImage" class="form-label">Primary Image</label>
                                                <input type="file" id="newsPrimaryImage" name="primary_image" class="form-control" accept="image/*">
                                            </div>
                                            <div class="mb-3">
                                                <label for="newsAdditionalMedia" class="form-label">Additional Media</label>
                                                <input type="file" id="newsAdditionalMedia" name="additional_media" class="form-control" accept="image/*,video/*">
                                            </div>
                                            <div class="mb-3">
                                                <div class="form-check">
                                                    <input type="checkbox" id="notifyUsers" name="notify_users" class="form-check-input">
                                                    <label for="notifyUsers" class="form-check-label">
                                                        <i class="fas fa-envelope me-2"></i>Notify users via email
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-end">
                                        <button type="submit" class="btn btn-primary btn-custom">
                                            <i class="fas fa-paper-plane me-2"></i>Publish Article
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Search Modal -->
    <div class="modal fade" id="userSearchModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-search me-2"></i>Search Users</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="form-control" id="userModalSearchInput" placeholder="Search users..." autocomplete="off">
                    </div>
                    <div id="userModalRecommendations" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- News Tag Modal -->
    <div class="modal fade" id="newsTagModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-tags me-2"></i>Manage News Tags</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <% if (NewsTags.length > 0) { %>
                        <% NewsTags.forEach(tag => { %>
                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded">
                                <span><%= tag.tag %></span>
                                <form action="/admin/delete-news-tag/<%= tag.tag_id %>" method="POST" class="d-inline">
                                    <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure?')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <p class="text-muted text-center">No tags found.</p>
                    <% } %>
                </div>
            </div>
        </div>
    </div>

    <!-- News Category Modal -->
    <div class="modal fade" id="newsCategoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-list me-2"></i>Manage News Categories</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <% if (NewsCategorys.length > 0) { %>
                        <% NewsCategorys.forEach(category => { %>
                            <div class="card mb-2">
                                <div class="card-body py-2">
                                    <form action="/admin/update-news-category/<%= category.category_id %>" method="POST" class="d-flex gap-2 align-items-center">
                                        <input type="text" name="category_name" class="form-control form-control-sm" value="<%= category.category_name %>" required>
                                        <button type="submit" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-save"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteCategory('<%= category.category_id %>')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <p class="text-muted text-center">No categories found.</p>
                    <% } %>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
        // Sidebar functionality
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
        });

        // Navigation functionality
        document.querySelectorAll('.nav-link[data-section]').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all nav links
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                
                // Add active class to clicked link
                this.classList.add('active');
                
                // Hide all page sections
                document.querySelectorAll('.page-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show target section
                const targetSection = document.getElementById(this.dataset.section);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
            });
        });

        // Status change functionality for applications
        $(document).ready(function(){
            $('.status-select').change(function(){
                var status = $(this).val();
                var id = $(this).data('id');
                $.ajax({
                    url: '/update_status', 
                    type: 'POST',
                    data: {
                        'status': status,
                        'id': id
                    },
                    success: function(result){
                        // Update the status badge
                        const card = $(`[data-id="${id}"]`).closest('.application-card');
                        const badge = card.find('.status-badge');
                        badge.removeClass('status-pending status-accepted status-rejected');
                        badge.addClass(`status-${status}`);
                        badge.text(status.charAt(0).toUpperCase() + status.slice(1));
                        
                        // Show success message
                        showAlert('Application status updated successfully!', 'success');
                    },
                    error: function(error){
                        showAlert('Error updating status. Please try again.', 'danger');
                    }
                });
            });
        });

        // Department edit functionality
        document.querySelectorAll('.edit-department-btn').forEach(button => {
            button.addEventListener('click', function() {
                const depId = this.dataset.id;
                const depName = this.dataset.name;
                
                document.getElementById('editDepName').value = depName;
                document.getElementById('editDepId').value = depId;
                document.getElementById('editDepartmentForm').action = `/admin/update-department/${depId}`;
            });
        });

        // Study Level edit functionality
        document.querySelectorAll('.edit-study-btn').forEach(button => {
            button.addEventListener('click', function() {
                const levelId = this.dataset.id;
                const levelName = this.dataset.name;
                
                document.getElementById('editStudyLevelName').value = levelName;
                document.getElementById('editStudyLevelId').value = levelId;
                document.getElementById('editStudyLevelForm').action = `/admin/update-study-level/${levelId}`;
            });
        });

        // File preview functionality
        function loadFile(event) {
            var output = document.getElementById('output');
            output.innerHTML = "";
            for(let i = 0; i < event.target.files.length; i++){
                var reader = new FileReader();
                reader.onload = function(){
                    var img = document.createElement('img');
                    img.src = reader.result;
                    img.className = 'img-fluid rounded m-1';
                    img.style.maxHeight = '80px';
                    output.appendChild(img);
                };
                reader.readAsDataURL(event.target.files[i]);
            }
        }

        function loadFile2(event) {
            var output = document.getElementById('output2');
            output.innerHTML = "";
            for(let i = 0; i < event.target.files.length; i++){
                var reader = new FileReader();
                reader.onload = function(){
                    var img = document.createElement('img');
                    img.src = reader.result;
                    img.className = 'img-fluid rounded m-1';
                    img.style.maxHeight = '80px';
                    output.appendChild(img);
                };
                reader.readAsDataURL(event.target.files[i]);
            }
        }

        // Auto-hide alerts
        setTimeout(function() {
            document.querySelectorAll('.alert').forEach(alert => {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 10000);

        // Utility function to show alerts
        function showAlert(message, type) {
            const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show position-fixed" 
                     style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', alertHtml);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                const alerts = document.querySelectorAll('.alert');
                if (alerts.length > 0) {
                    const latestAlert = alerts[alerts.length - 1];
                    const bsAlert = new bootstrap.Alert(latestAlert);
                    bsAlert.close();
                }
            }, 5000);
        }

        // Category deletion function
        function deleteCategory(categoryId) {
            if (confirm('Are you sure you want to delete this category?')) {
                fetch(`/admin/delete-news-category/${categoryId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                }).then(response => {
                    if (response.ok) {
                        location.reload();
                    } else {
                        alert('Error deleting category');
                    }
                });
            }
        }

        // Mobile responsiveness
        if (window.innerWidth <= 768) {
            document.getElementById('sidebar').classList.add('collapsed');
            document.getElementById('mainContent').classList.add('expanded');
        }

        // Search functionality placeholders (you can integrate with existing search scripts)
        // These would connect to your existing search endpoints
        
    </script>

    <!-- Include existing scripts for backwards compatibility -->
    <script src="/static/js/loginInformation.js" defer></script>
    <script src="/static/js/partners.js"></script>
    <script src="/static/js/Courses.js" defer></script>
</body>
</html>